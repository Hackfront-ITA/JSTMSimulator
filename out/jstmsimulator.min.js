/*
 * JSTMSimulator - A Turing Machine simulator written in JavaScript.
 * Copyright (C) 2016 VittGam.net. All Rights Reserved.
 * https://www.turingsimulator.net/
 *
 * See https://www.turingsimulator.net/github for source code.
 *
 * Please see the attached LICENSE file for licensing information.
 */
(function(){var e=function(e){if(!e)return null;var t=function(t,r){if(e[t])try{e[t](r)}catch(n){}},r="!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^-{|}",n="",a={},o=this;o.stepcount=0,o.lastmove="-",o.tapetext="",o.tapepos=0,o.currstate="0",o.currtickline=0,o.stopped=!0;var i=function(e){return this instanceof i?(e&&(this.type=e),void 0):new i(e)};i.prototype=Error(),i.prototype.name="TMError",i.toString=function(){return"function TMError() { [native code] }"},i.toString.toString=i.toString;var s=function(e,t){if(e)for(var r=0;e.length>r;r++)if(r in e&&e[r]===t)return r;return-1},l=function(){if(o.stopped)return!1;for(;0>o.tapepos;)o.tapetext=" "+o.tapetext,o.tapepos++;for(;o.tapepos>=o.tapetext.length;)o.tapetext=o.tapetext+" ";var e=o.tapetext.charAt(o.tapepos);return a[o.currstate]&&a[o.currstate][e]?(o.tapetext=o.tapetext.substring(0,o.tapepos)+a[o.currstate][e][1]+o.tapetext.substring(o.tapepos+1),"<"===a[o.currstate][e][2]?(o.lastmove="<",o.tapepos--):">"===a[o.currstate][e][2]?(o.lastmove=">",o.tapepos++):o.lastmove="-",o.stepcount++,o.currtickline=a[o.currstate][e][3],o.currstate=a[o.currstate][e][0],t("onaftertick"),!0):(o.stopped=!0,t("onstop"),!1)},E=function(e,t,r){var n=(r===void 0?0:r)-1;do n=e.indexOf(t,n+1);while("\\"===e.charAt(n-1)&&("\\"!==e.charAt(n-2)||"\\"===e.charAt(n-3)));return n},c=function(e,t){var r,a,o=E(n,"(");4===t?(r=E(n,")"),a=-1):(r=E(n,","),a=E(n,")"));var s=n.indexOf("\n");if(-1!==o&&r>o)throw new i("READ_ERROR_EXPECTED_COMMA");if(-1!==a&&r>a)throw new i("READ_ERROR_EXPECTED_COMMA");if(-1!==s&&r>s)throw new i("READ_ERROR_EXPECTED_COMMA");var l=n.substring(0,r).replace(RegExp("^\\s\\s*"),"").replace(RegExp("\\s\\s*$"),"");if(n=n.substring(r+1),""===l){if(0===t)throw new i("READ_ERROR_EMPTY_SOURCE_STATUS");if(1===t)throw new i("READ_ERROR_EMPTY_SOURCE_SYMBOL");if(2===t)throw new i("READ_ERROR_EMPTY_DESTINATION_STATUS");if(3===t)throw new i("READ_ERROR_EMPTY_DESTINATION_SYMBOL");if(4===t)throw new i("READ_ERROR_EMPTY_MOVEMENT");throw new i("READ_ERROR")}var c=E(l,"["),u=E(l,"]"),_=E(l,"{"),d=E(l,"}"),A=E(l,"^");if(-1!==c){if(-1===u)throw new i("READ_ERROR_WRONG_CHARACTER_CLASS");if(-1!==_||-1!==d)throw new i("READ_ERROR_EXPECTED_COMMA");if(-1!==A&&A!==c+1)throw new i("READ_ERROR_EXPECTED_COMMA");if(0!==t&&2!==t&&(0!==c||u!==l.length-1))throw new i("READ_ERROR_EXPECTED_COMMA");if((0===t||2===t)&&-1!==E(l,"[",c+1))throw new i("READ_ERROR_EXPECTED_COMMA");if((0===t||2===t)&&-1!==E(l,"]",u+1))throw new i("READ_ERROR_EXPECTED_COMMA");return R(0,e,l.substring(c+1,u),l.substring(0,c),l.substring(u+1))}if(-1!==_){if(-1===d)throw new i("READ_ERROR_WRONG_CHARACTER_CLASS");if(-1!==c||-1!==u)throw new i("READ_ERROR_EXPECTED_COMMA");if(-1!==A&&A!==_+1)throw new i("READ_ERROR_EXPECTED_COMMA");if(0!==t&&2!==t&&(0!==_||d!==l.length-1))throw new i("READ_ERROR_EXPECTED_COMMA");if((0===t||2===t)&&-1!==E(l,"{",_+1))throw new i("READ_ERROR_EXPECTED_COMMA");if((0===t||2===t)&&-1!==E(l,"}",d+1))throw new i("READ_ERROR_EXPECTED_COMMA");return R(1,e,l.substring(_+1,d),l.substring(0,_),l.substring(d+1))}if(0!==t&&2!==t)return R(l.length>1?2:3,e,l,"","");if("\\"===l.charAt(l.length-1)&&"\\"!==l.charAt(l.length-2))throw new i("READ_ERROR_EXPECTED_COMMA");return l.replace(RegExp("\\\\(.)","g"),"$1")},u=function(e,t,r,n,o,s){var l=null;if(t instanceof Array?l=t:r instanceof Array?l=r:n instanceof Array?l=n:o instanceof Array?l=o:s instanceof Array&&(l=s),null===l){if("<"!==s&&">"!==s&&" "!==s)throw new i("READ_ERROR_WRONG_MOVEMENT");a[t]||(a[t]={}),a[t][r]=[n,o,s,e]}else for(var E=t instanceof Array&&t[0]===l[0],c=r instanceof Array&&r[0]===l[0],R=n instanceof Array&&n[0]===l[0],_=o instanceof Array&&o[0]===l[0],d=s instanceof Array&&s[0]===l[0],A=1;l.length>A;A++)u(e,E?t[A]:t,c?r[A]:r,R?n[A]:n,_?o[A]:o,d?s[A]:s)},R=function(e,n,a,o,l){var E=[],c=!1,u=o,R=l;for("^"===a.charAt(0)&&(c=!0,a=a.substring(1),o=l="",3===e&&(e=2));a.length;)if("\\"!==a.charAt(0)||".."===a.substr(2,2)&&""!==a.charAt("\\"===a.charAt(4)?5:4))if("-"===a.charAt(0))E.push(o+" "+l),a=a.substring(1);else if("\\"===a.charAt(0)?".."===a.substr(2,2)&&""!==a.charAt("\\"===a.charAt(4)?5:4):".."===a.substr(1,2)&&""!==a.charAt("\\"===a.charAt(3)?4:3)){var _=a.charAt(0);"\\"===_&&(_=a.charAt(1),a=a.substring(1));var d=a.charAt(3);"\\"===d?(d=a.charAt(4),a=a.substring(5)):a=a.substring(4);var A=r.indexOf(_),p=r.indexOf(d);if(p>=A)for(;p>=A;A++)E.push(o+r.charAt(A)+l);else for(t("onwarning","WARNING_ASCENDING_CHARACTER_CLASS");A>=p;A--)E.push(o+r.charAt(A)+l)}else E.push(o+a.charAt(0)+l),a=a.substring(1);else E.push(o+a.charAt(1)+l),a=a.substring(2);if(c){for(var O=[],m=0;r.length>m;m++)-1===s(E,r.charAt(m))&&O.push(u+r.charAt(m)+R);-1===s(E," ")&&O.push(u+" "+R),E=O}if(1===E.length&&(e=3),1>E.length)throw new i("READ_ERROR_EMPTY_CHARACTER_CLASS");if(n[e]&&n[e]!==E.length)throw new i("READ_ERROR_WRONG_CHARACTER_CLASS");return n[e]=E.length,E.unshift(e),E},_=function(){if(o.stopped){t("onprestart");try{n=(e.code+"").toUpperCase().replace(RegExp("(?:\r\n|\r)","g"),"\n"),a={},o.lastmove="-",o.stepcount=0,o.tapetext=(e.tapetext+"").toUpperCase(),o.tapepos=0,o.currstate="0",o.currtickline=0,o.stopped=!1;for(var r=0,s=!1;!s;)switch(n.substr(0,1)){case"":s=!0;break;case"#":r++,-1===n.indexOf("\n")?(n="",s=!0):n=n.substring(n.indexOf("\n")+1);break;case"\n":r++,n=n.substring(1);break;case" ":n=n.substring(1);break;case"(":n=n.substring(1);var E={},R=c(E,0),_=c(E,1),d=c(E,2),A=c(E,3),p=c(E,4);u(r,R,_,d,A,p);break;default:throw new i("READ_ERROR_UNEXPECTED_END_OF_RULE")}t("onstart"),l()}catch(O){o.stopped=!0,t("onerror",{errorMessage:O instanceof i?O.type:O.message||O,errorType:O instanceof i?"syntax":"unknown",errorLine:r})}}};o.tick=l,o.start=_,o.stop=function(){o.stopped=!0}},t={};t.en={START_BUTTON:"Start",STOP_BUTTON:"Stop",SPEED_LABEL:"Speed:",STEPS_LABEL:"Steps:",STOPPED:"End of computation.",UNKNOWN_ERROR_LABEL:"Error:",SYNTAX_ERROR_LABEL:"Syntax error at line %d:",READ_ERROR:"A read error occurred",READ_ERROR_EXPECTED_COMMA:'A "," was expected as separator',READ_ERROR_EMPTY_SOURCE_STATUS:"A read error occurred while reading the source status",READ_ERROR_EMPTY_SOURCE_SYMBOL:"A read error occurred while reading the source symbol",READ_ERROR_EMPTY_DESTINATION_STATUS:"A read error occurred while reading the destination status",READ_ERROR_EMPTY_DESTINATION_SYMBOL:"A read error occurred while reading the destination symbol",READ_ERROR_EMPTY_MOVEMENT:"A read error occurred while reading the movement",READ_ERROR_WRONG_MOVEMENT:"The movement is not correct",READ_ERROR_EMPTY_CHARACTER_CLASS:"One of the character classes in the rule is empty",READ_ERROR_WRONG_CHARACTER_CLASS:"The character classes in the rule are of different length",READ_ERROR_UNEXPECTED_END_OF_RULE:"Unexpected end of rule",WARNING_ASCENDING_CHARACTER_CLASS:'Warning: implicit ascending character classes (eg. "z..a") are not supported by the official simulator!\nWe suggest you to expand implicit ascending classes, for example "9..0" should become "9876543210".',WARNING_WONT_BE_SHOWN_AGAIN:"This warning will not be shown again for this session.",EXIT_CONFIRMATION:"Are you sure you want to exit?",LOAD_BUTTON:"Load",SAVE_BUTTON:"Save",LOAD_CONFIRMATION:'Are you sure you want to load the program "{program_name}"?\n\nThe code in the box will not be saved if it has been modified after the last save, or if it has never been saved!\n\nAre you sure you want to load the program "{program_name}"?',LOAD_CONFIRMATION_NOSAVE:'Are you sure you want to load the program "{program_name}"?\n\nThe code in the box will be overwritten!\n\nAre you sure you want to load the program "{program_name}"?',SAVE_CONFIRMATION:'Are you sure you want to save the current program as "{program_name}" on the server?\n\nPrevious saves for "{program_name}" will be overwritten! Make sure you have selected the correct program!\n\nAre you sure you want to save the program "{program_name}"?',LOAD_RESULT_OK:"Program loaded successfully from the server.",LOAD_RESULT_FAIL:"An unknown error occurred while trying to load the program from the server. Please try again later.",SAVE_RESULT_OK:"Program saved successfully on the server.",SAVE_RESULT_FAIL:"An unknown error occurred while trying to save the program on the server. Please try again later.",USERNAME_LABEL:"User:"},t.it={START_BUTTON:"Esegui",STOP_BUTTON:"Stop",SPEED_LABEL:"Velocità:",STEPS_LABEL:"Passi:",STOPPED:"Fine della computazione.",UNKNOWN_ERROR_LABEL:"Errore:",SYNTAX_ERROR_LABEL:"Errore di sintassi (linea %d):",READ_ERROR:"Errore nella lettura",READ_ERROR_EXPECTED_COMMA:'Era attesa la "," come separatore',READ_ERROR_EMPTY_SOURCE_STATUS:"Errore nella lettura dello stato di partenza",READ_ERROR_EMPTY_SOURCE_SYMBOL:"Errore nella lettura del simbolo da leggere",READ_ERROR_EMPTY_DESTINATION_STATUS:"Errore nella lettura dello stato di destinazione",READ_ERROR_EMPTY_DESTINATION_SYMBOL:"Errore nella lettura del simbolo da scrivere",READ_ERROR_EMPTY_MOVEMENT:"Errore nella lettura del movimento da eseguire",READ_ERROR_WRONG_MOVEMENT:"Lo spostamento non è corretto",READ_ERROR_EMPTY_CHARACTER_CLASS:"Una delle classi di caratteri nella regola è vuota",READ_ERROR_WRONG_CHARACTER_CLASS:"Le classi di caratteri nella regola hanno lunghezze differenti",READ_ERROR_UNEXPECTED_END_OF_RULE:"Fine inattesa della regola",WARNING_ASCENDING_CHARACTER_CLASS:'Attenzione: ricorda che le classi di caratteri ascendenti implicite (ad es. "z..a") non sono supportate dal simulatore ufficiale!\nTi suggeriamo di espandere le classi ascendenti implicite, ad esempio "9..0" dovrebbe diventare "9876543210".',WARNING_WONT_BE_SHOWN_AGAIN:"Questo avviso non verrà mostrato di nuovo per questa sessione.",EXIT_CONFIRMATION:"Sei sicuro di voler uscire?",LOAD_BUTTON:"Carica",SAVE_BUTTON:"Salva",LOAD_CONFIRMATION:'Sei sicuro di voler caricare il programma "{program_name}"?\n\nIl codice presente nella casella non verrà salvato se è stato modificato dall\'ultimo salvataggio, o se non è mai stato salvato!\n\nContinuare nel caricare il programma "{program_name}"?',LOAD_CONFIRMATION_NOSAVE:'Sei sicuro di voler caricare il programma "{program_name}"?\n\nIl codice presente nella casella verrà sovrascritto!\n\nContinuare nel caricare il programma "{program_name}"?',SAVE_CONFIRMATION:'Sei sicuro di voler salvare il programma corrente come "{program_name}" sul server?\n\nI salvataggi precedenti per "{program_name}" verranno sovrascritti! Assicurarsi di aver selezionato il programma corretto!\n\nContinuare nel salvare il programma "{program_name}"?',LOAD_RESULT_OK:"Programma caricato con successo dal server.",LOAD_RESULT_FAIL:"Si è verificato un errore sconosciuto durante il caricamento del programma dal server. Riprova più tardi.",SAVE_RESULT_OK:"Programma salvato con successo sul server.",SAVE_RESULT_FAIL:"Si è verificato un errore sconosciuto durante il salvataggio del programma sul server. Riprova più tardi.",USERNAME_LABEL:"Utente:"};var r=t.en;try{var n=window.navigator&&(navigator.language||navigator.userLanguage||navigator.browserLanguage);n&&t[(n+"").substr(0,2)]&&(r=t[(n+"").substr(0,2)]),n=null}catch(a){}for(var o=null,i=!1,s=null,l=!1,E=null,c=null,u=null,R=null,_=null,d=[1500,1350,1200,1050,900,750,600,450,300,150,0,-1],A=document.getElementById("status"),p=document.getElementById("state"),O=document.getElementById("username"),m=document.getElementById("code"),T=document.getElementById("input"),g=document.getElementById("tape"),f=document.getElementById("speedlbl"),h=document.getElementById("speed"),S=document.getElementById("startbtn"),v=document.getElementById("stopbtn"),N=document.getElementById("progs"),C=document.getElementById("loadbtn"),w=document.getElementById("savebtn"),D=document.getElementById("moveleft"),b=document.getElementById("moveright"),L=[],M=0;31>M;M++)L[M]=document.getElementById("cell"+M);var y="textContent"in document.body?"textContent":"innerText",I=function(e,t){e&&(e[y]=t)};S.value=r.START_BUTTON,v.value=r.STOP_BUTTON,C.value=r.LOAD_BUTTON,w.value=r.SAVE_BUTTON,I(f,r.SPEED_LABEL);for(var P=function(e,t){clearTimeout(E),I(A,e||""),t||""===e||(E=setTimeout(function(){I(A,"")},5e3))},B=function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+("change"===t?"propertychange":t),r)},U=function(e,t){try{if(document.activeElement===h)return;if(0>t)return;for(var r=0,n=0,a=e.value.replace(RegExp("(?:\r\n|\r)","g"),"\n"),o=a.length,i=t;i>0;i--)if(r=a.indexOf("\n",r)+1,0===r)return;if(n=a.indexOf("\n",r),("number"!=typeof r||0>r||r>o)&&(r=0),("number"!=typeof n||0>n||n>o)&&(n=o),r>=n)return;var s=null;if((window.getComputedStyle&&(s=window.getComputedStyle(e,null))||document.defaultView&&document.defaultView.getComputedStyle&&(s=document.defaultView.getComputedStyle(e,null)))&&(s=parseInt(s.getPropertyValue("line-height"),10)),s||(s=parseInt((e.currentStyle||e.style||{}).lineHeight||16,10)),e.scrollTop=Math.max(0,t*s-(e.clientHeight-s)/2),s=null,0===r&&n===o&&"function"==typeof e.select)e.select();else if(e.setSelectionRange)e.setSelectionRange(r,n);else if(e.createTextRange){var l=e.createTextRange();l.collapse(!0),l.moveEnd("character",n),l.moveStart("character",r),l.select(),l=null}window.setTimeout(function(){e.scrollLeft=0},0)}catch(E){}},x=function(){var e=!1;if(0===s?s="-"===o.lastmove?3:1:1===s?(s=2,e=!0):2===s?s=0:3===s?(s=4,e=!0):4===s?s=0:(s=0,e=!0),e){for(var t=0;31>t;t++)I(L[t],o.tapetext.charAt(t+o.tapepos-15));S.disabled&&U(m,o.currtickline),I(p,o.currstate),P(r.STEPS_LABEL+" "+o.stepcount,!0)}var n=[];return(1===s||2===s)&&n.push("anim"+s),2===s&&("<"===o.lastmove?n.push("movedleft"):">"===o.lastmove&&n.push("movedright")),n=n.join(" "),g.className!==n&&(g.className=n),n=null,0===s&&o.stopped?(P(r.STOPPED+" "+r.STEPS_LABEL+" "+o.stepcount,!0),s=null,m.readOnly=T.disabled=S.disabled=N.disabled=C.disabled=w.disabled=!1,void 0):(c=setTimeout(x,_),void 0)},W=function(){R=d[h.selectedIndex],-1===R?(R=0,_=130):_=R/3},Y=function(){o=new e({code:m.value,tapetext:T.value,onaftertick:function(){u=setTimeout(o.tick,R)},onprestart:function(){m.readOnly=T.disabled=S.disabled=N.disabled=C.disabled=w.disabled=!0,i=!0,s=null,clearTimeout(c),clearTimeout(u)},onstart:function(){P(),v.disabled=!1,W(),m.focus(),x()},onstop:function(){v.disabled=!0,s=null,x()},onerror:function(e){v.disabled=!0,clearTimeout(c),clearTimeout(u),P(("syntax"===e.errorType?(r.SYNTAX_ERROR_LABEL+"").replace("%d",e.errorLine+1):r.UNKNOWN_ERROR_LABEL)+" "+r[e.errorMessage]),s=null,m.readOnly=T.disabled=S.disabled=N.disabled=C.disabled=w.disabled=!1,m.focus(),U(m,e.errorLine)},onwarning:function(e){"WARNING_ASCENDING_CHARACTER_CLASS"!==e||l?alert(r[e]||e):(l=!0,alert(r.WARNING_ASCENDING_CHARACTER_CLASS+"\n\n"+r.WARNING_WONT_BE_SHOWN_AGAIN))}}),o.start()},X=[p,O,f,A,g,D,b],G=("onselectstart"in document.body?"selectstart":"mousedown"),V=function(e){return e||(e=window.event),e.preventDefault&&e.preventDefault(),!1},k=0;X.length>k;k++)B(X[k],G,V);X=G=V=null,B(S,"click",Y),B(v,"click",function(){v.disabled=!0,o&&o.stop()}),B(D,"click",function(){o&&o.stopped&&!S.disabled&&(o.tapepos++,s=null,x())}),B(b,"click",function(){o&&o.stopped&&!S.disabled&&(o.tapepos--,s=null,x())}),B(h,"change",function(){W(),this.blur()}),window.onbeforeunload=function(){return i||""!==m.value?r.EXIT_CONFIRMATION:void 0},m.disabled=m.readOnly=T.disabled=h.disabled=S.disabled=N.disabled=C.disabled=w.disabled=!1})();
//# sourceMappingURL=jstmsimulator.min.js.map